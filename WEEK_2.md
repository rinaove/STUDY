# 2주차: CH2 데이터와 표본분포

## 2.1 임의표본추출과 표본편향
### 2.1.1 편향
`통계적 편향`: 측정 과정 혹은 표본추출 과정에서 발생하는 계통적인 오차를 의미한다. 

    * 계통상 오류란?
    ✅ 계통상 오류(systematic error, 계통 오차)는 일관되게 같은 방향으로 발생하는 오류를 의미.
    ✅ 무작위 오류(random error)와 반대되는 개념으로, 측정 과정이나 데이터 수집 방법 자체에 문제가 있어 지속적으로 편향된 결과를 초래.

    * 특징
    ✅ 무작위 오류와 달리, 반복 측정해도 오차가 사라지지 않음
    ✅ 측정 기기, 방법, 표본 추출 방식 등에서 구조적인 문제로 발생

| 계통상 오류  | 기준  | 무작위 오류  |
| ---- | ------ | ---- |
구조적 문제 | 원인 | 우연적 요인  
평균적으로 상쇄됨  | 반복 측정 시  | 그대로
편향  | 관련 용어  | 분산


## 2.2 선택편향
* 정의: 데이터를 의식적 혹은 무의식적이든 선택적으로 고르는 관행
* 결과: 오해의 소지가 있거나 단편적인 결론을 얻음
* 용어
    * `데이터 스누핑`: 뭔가 흥미로운 것을 찾아 광범위하게 데이터를 살피는 것
    * `방대한 검색 효과`: 중복 데이터 모델링이나 너무 많은 예측변수를 고려하는 모델링에서 비룟되는 편향 혹은 비재현성


```
* 비재현성이란? 
✅ 같은 실험이나 연구를 반복해도 동일한 결과가 나오지 않는 현상
```


### 2.2.1 평균으로의 회귀
* 정의: 주어진 어떤 변수를 연속적으로 측정했을 때 나타나는 현상. 
* 특징: 극단적인 경우로가 관찰되었을 때, 다음 번 측정에서는 평균에 가까운 값이 나올 가능성이 높음. 

```
* 예시
✅ 스포츠에서 "신인 징크스" → 신인이 첫해에 좋은 성적을 거두면, 다음 시즌에는 보통 성적이 하락하는데, 이는 실력 저하 때문이 아니라 평균 회귀 현상 때문일 수 있음.

✅ 의학에서 치료 효과 착각 → 병이 심할 때 병원을 방문하면 자연적으로 회복될 가능성이 높은데, 이를 치료 효과로 착각할 수 있음.
```

## 2.3 통계학에서의 표본분표
```
* 데이터 분포와 표본분포
✅ 데이터 분포: 한 모집단 혹은 표본에서 개별 데이터 값들이 퍼져 있는 형태를 의미
✅ 표본분포: 표본통계량(예: 표본평균, 표본비율 등)이 여러 번 추출될 때 따르는 분포를 의미 


* 표본평균의 표본분포 코드
loans_income.sample(20).mean() for _ in range(1000)
❗️ 딕셔너리의 value 부분에도 for문을 넣을 수 있음
ex. {키: 값 for 변수 in 반복가능한 객체}
```

### 2.3.2 표준 오차
* 표본 오차: 표본 크기가 커지면 표준오차가 줄어들고, 표준편차가 커지면 표준 오차가 늘어난다.

## 2.4 부트스트랩
> ⚠️ 제가 이해한게 맞는지 모르겠어요. 질문 많이 해주세요 or 저한테 설명 please

* 정의: 현재 있는 표본에서 추가적으로 표본을 복원추출하고 각 표본에 대한 통계량과 모델을 다시 계산
* 즉, 표본을 수천, 수백만 번 복제하는 것.

````
* 왜 사용?
✅ 실제 데이터에서 표준편차 및 신뢰구간을 발견할 때 유용 (실제 데이터는 정규성을 안 따를 확률이 높음)
✅ 모집단 정보 모를 때 표본 자체에서 반복 추출하여 분포를 추정. 중심극한정리 역시 모집단 정보를 모르지만, 표본이 크다는 것을 가정하고 정규성을 띈다고 전제.
✅ 그러나, 부트스트랩은 표본의 크기가 작을 때 사용 가능하며 해당 경우 정규성을 띈다고 전제할 수 없음. 그렇기에 반복 추출을 통해(몇백 번), 직접 표본통계량을 추측하는 것.
````
* 부트스트랩 vs 중심극한정리

|   | 부트스트랩  |	중심극한정리 (CLT) |
|--- | ----------- | ------------------|
| 가정 |	정규성을 가정하지 않음	| 표본 크기가 크면 정규분포를 따름
| 방법 |	주어진 표본에서 복원추출하여 반복 샘플링 |	모집단에서 여러 개의 표본을 뽑아 표본평균 분포를 형성
| 목적	| 신뢰구간 추정, 통계량 분포 분석 | 표본평균의 분포가 정규성을 따르는지 설명
| 계산량 |	반복 추출로 계산량이 많음	| 표본 크기만 크면 됨 

* 정규성을 따른다? vs 안따른다?

|   | 정규성을 가정하는 경우	|정규성을 가정하지 않는 경우 |
| --- | ---- | ---- |
| 설명	| 데이터가 정규분포를 따른다고 전제| 데이터 분포에 대한 가정 없이 분석
| 예제 |	t-검정, ANOVA 등 전통적인 통계 방법	| 부트스트랩, 순위 검정 등 비모수적 방법
| 장점	| 수학적으로 정확한 추론 가능	| 실제 데이터가 정규분포가 아니어도 적용 가능
| 단점 | 	정규성이 깨지면 결과가 신뢰할 수 없음 | 	계산량이 많을 수 있음


## 2.5 신뢰구간
```
* 신뢰구간 해석법
💡 "신뢰수준이 95%인 신뢰구간"이라면, 100번 표본을 추출해서 신뢰구간을 계산하면, 그중 약 95개의 신뢰구간이 실제 모집단의 참값을 포함한다는 의미
💡 즉, 신뢰구간을 한 번 계산했다고 해서 반드시 모수가 포함된다고 보장할 수 없음
```

## 2.6 정규분포
* 표준화하다: 평균을 빼고 표준편차로 나누기
* z-score: 개별 데이터 포인트를 정규화한 결과 
* QQ 그림: 표본분포가 특정 분포에 얼마나 가까운지 보여주는 그림 

### 2.6.1 표준정규분포와 QQ그림
* x축: 정규분포에서의 해당 분위수 (X = 평균 + 표준편차 * z-score)
* y축: z-score
* 특징: 선형 관계를 띄면 정규성을 띈다고 볼 수 있음
* 정규성 확인법: y=x를 그려 분포가 그래프 모양과 비슷한지 확인
* 파이썬: `scipt.stats.probplot 메서드`

## 2.7 긴 꼬리 분포
```
* 왜 중요?
✅ 이례적 사건이 주는 교훈(like 블랙 스완 이론): 실무에서는 긴 꼬리를 잘 들여다보는 것을 중요하게 여김 
```

## 2.8 스튜던트의 t 분포
* 특징: 규분포에 비해 꼬리가 두껍고 길다 (정규분포보다 대표성X)

```
* 왜 중요?
✅ 부트스트랩의 표본추출을 통해서도 표본 오차를 얻을 수 있지만, R이나 A/B 검정, 회귀분석 같은 통계 절차를  통해 나온 t 통계량을 이해하기 위해서
✅ 즉, 실무보다는 이론적 이해를 위해 필요
```

## 2.9 이항분포

```
* 왜 중요?
✅ 두 가지 결과를 나타내는 모델을 만들 때 중요 
✅ n이 크고 p가 0 또는 1에 가깝지 않은 경우 이항 분포 = 정규 분포로 근사 가능 
-> 머리로는 이해되는데 약간 100% 이해한건아님...
```


```
* 코드
scipy.stats 모듈의 stats.binon.pmf 와 stats.binom.cdf 함수 이용

# size = 5인 시행에서 각 시행의 성공 확률이 10%일 때, x=2인 성공이 나올 확률
stats.binom.pmf(2, n=5, p=0.1)
stats.binom.cdf(2, n=5, p=0.1)
```

## 2.10 카이제곱분포
* 카이제곱통계량: 검정 결과가 독립성에 대한 귀무 기댓값에 벗어난 정도를 측정하는 통계량
    * 즉, 각 확률변수에 대한 오차제곱값을 더한 것
    * 기댓값: 데이터에서 특이하거나 주목할 만한 것이 없다는 뜻

```
* 왜 중요?
😑 나의 생각: 그냥 오차값만 보면 되지, 굳이 오차값의 제곱을 다 더한 카이제곱통계량을 보는 이유가 뭐지? 
✅ 각각 오차값을 보면 방향성만 보는 것 (양수, 음수) 
✅ 제곱해서 더해여 전체 오차 크기를 실감할 수 있어서
✅ p-value를 확인해 오차가 나올 확률이 희귀한지 아닌지 확인하는 것 
```

* 언제 사용할까?

| 검정 이름  | 언제 사용?	|예시 |
| --- | ---- | ---- |
| 적합도 검정 (Goodness of Fit)	| 데이터가 특정 분포를 따르는지 검정  | 주사위가 공정한가? / 유전자 분포 비율?
| 독립성 검정 (Test of Independence) | 	두 범주형 변수 간에 관계 있는지 검정 | 	성별 vs 음료 취향 / 지역 vs 투표 성향
| 동질성 검정 (Test of Homogeneity)	| 여러 집단의 분포가 같은지 검정 | 	여러 매장 고객 비율 비교 / 학교별 성별 비율 비교

* 코드
```
# 적합도 검정
from scipy.stats import chisquare

# 주사위 눈 별 관측 횟수 (예: 실제 굴려본 결과)
observed = [18, 17, 16, 15, 17, 17]

# 공정한 주사위라면 기대 횟수
expected = [16.6667] * 6

chi2, p = chisquare(f_obs=observed, f_exp=expected)

print("적합도 검정")
print("Chi2 Statistic:", chi2)
print("p-value:", p)
```

```
# 독립성 검정
import pandas as pd
from scipy.stats import chi2_contingency

# 관측값 (행: 성별, 열: 제품 선호도)
data = [[30, 10],  # 남자
        [20, 40]]  # 여자

chi2, p, dof, expected = chi2_contingency(data)

print("독립성 검정")
print("Chi2 Statistic:", chi2)
print("p-value:", p)
print("기대값 테이블:\n", pd.DataFrame(expected))
```
```
# 동질성 검정
data = [[20, 15, 15],  # 지역 A
        [25, 20, 15],  # 지역 B
        [30, 10, 10]]  # 지역 C

chi2, p, dof, expected = chi2_contingency(data)

print("동질성 검정")
print("Chi2 Statistic:", chi2)
print("p-value:", p)
print("기대값 테이블:\n", pd.DataFrame(expected))
```

* 카이제곱 분포
    * 자유도가 클수록 정규분포 그래프를 띈다


## 2.11 F 분포
* 정의: 두 개의 카이제곱 통계량(각각 분산에 비례)을 자유도만큼 나눠서 비율로 비교
* 검정 종류: 등분산 검정 (분산 같나?) / anova 검정 (분산은 같다고 생각. 그럼 평균 비슷?)
* 구조: 분산1 / 분산2
    * H0 : 분산1 = 분산2 (같은 집단이다)
    → 관찰된 F값이 크다? 
    → 우연히 이렇게 분산차이 클 확률이 적네
    → 귀무가설 기각

| 관점  | 계산 공식	|의미 |
| --- | ---- | ---- |
| 등분산 검정 | 	두 집단 분산 비교 |	분산1 / 분산2
| ANOVA (아노바) | 	여러 집단 평균 차이 검정 |	그룹 간 분산 / 그룹 내 분산


```
* 왜 중요?
✅ 여러 카이제곱 분포에서 각 그룹 내 변동성에 대한 평균 간 변동성 비율 확인
✅ 즉,  그룹 간 평균 차이가 우연인가 필연인가? 를 확인
✅ 우연이 아니다! 라고 하면 유의미한 집단의 값들을 분석할 이유가 O
```

> ⚠️ 파이썬으로 데이터 분석 시 어떤 경우에 해당 검정 및 분포를 확인하는지 다같이 짓피티 물어보면서 확인하면 좋겠어요

## 2.12 푸아송 분포와 그 외 관련 분포들
* 람다(lambda): 단위 시간이나 면적당 사건이 발생하는 비율 

### 2.12.1 푸아송 분포
* 정의: 표집된 단위 시간 혹은 단위 공간에서 발생한 사건의 도수 분포. 대기행렬 관련 질문 처리 시 유용

```
* 코드
1분당 평균 2회 문의 전화 접수 시, 100분을 시뮬레이션하여 100분당 문의 전화 횟수 알아냄

# scipy 모듈에서 stats.possion.rvs 함수: 람다 = 2, 난수 100개 생성 코드 
stats.possion.rvs(2, size=100)
```

### 2.12.2 지수 분포
* 정의: 한 사건에서 그다음 사건까지의 시간이나 거리에 대한 도수분포
* 푸아송 분포와 차이: 푸아송 분포의 확률 변수는 '사건 횟수' / 지수 분포의 확률 변수는 '사이 시간' 

```
* 코드
1분당 평균 0.2회 서비스 문의 전화 걸려오는 경우, 100분 내 전화와 전화 사이 걸리는 값들 계산

stats.expon.rvs(scale=1/0.2, size=100)
```

### 2.12.4 베이불 분포
* 사건 발생률이 시간에 따라 지속적으로 변할 때 사용 ex. 기계 고장률 
* 지수 분포를 확장하여, 형상 파라미터를 베타로 설정
    * 베타 > 1, 발생률은 시간에 따라 증가
    * 베타 < 1, 시간에 따라 감소 

- - -

## 육각형 구간 vs 등고도표 헷갈렸던 점 
* 등고도표의 선은 무슨 의미?: 밀도가 같은 지점을 선(contour line)으로 연결
    * 경계선이 많거나 좁게 붙어 있으면 → 변화가 급격
    * 경계선이 넓게 퍼져있으면 → 변화가 완만
    * x,y 값이 아닌 z값을 연결하여 비교

* 육각형 구간 코드

```
plt.hexbin(x, y, gridsize=30, cmap='Blues')
```

| 변수 | 	역할 |
| --- | -------- |
|x, y	| 2차원 데이터 좌표
| gridsize	| 육각형 크기 조절 (값이 클수록 육각형이 커짐 → 구간 수 적어짐)
| cmap |	색상맵 설정
| reduce_C_function	| 집계 방식 (sum, mean, count 등)


* 등고도표 코드

```
plt.contour(X, Y, Z, levels=10, cmap='viridis')
plt.contourf(X, Y, Z, levels=10, cmap='viridis')  # 채운 등고선
```

| 변수   | 역할                          |
|--------|--------------------------------|
| X, Y   | 좌표 그리드 (meshgrid 사용)   |
| Z      | 값 (X, Y 좌표에 대응하는 밀도나 값) |
| levels | 등고선 갯수 또는 값 구간 지정 |
| cmap   | 색상맵 설정                  |



